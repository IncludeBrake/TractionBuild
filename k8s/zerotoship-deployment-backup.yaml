apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    deployment.kubernetes.io/revision: "3"
    kubectl.kubernetes.io/last-applied-configuration: |
      {"apiVersion":"apps/v1","kind":"Deployment","metadata":{"annotations":{},"labels":{"app":"zerotoship","component":"app"},"name":"zerotoship-app","namespace":"zerotoship"},"spec":{"replicas":2,"selector":{"matchLabels":{"app":"zerotoship","component":"app"}},"template":{"metadata":{"annotations":{"vault.hashicorp.com/agent-inject":"true","vault.hashicorp.com/agent-inject-secret-apikeys.env":"secret/data/zerotoship/dev/apikeys","vault.hashicorp.com/agent-inject-secret-database.env":"secret/data/zerotoship/dev/database","vault.hashicorp.com/agent-inject-template-apikeys.env":"{{- with secret \"secret/data/zerotoship/dev/apikeys\" -}}\nOPENAI_API_KEY={{ .Data.data.OPENAI_API_KEY }}\nANTHROPIC_API_KEY={{ .Data.data.ANTHROPIC_API_KEY }}\n{{- end -}}\n","vault.hashicorp.com/agent-inject-template-database.env":"{{- with secret \"secret/data/zerotoship/dev/database\" -}}\nNEO4J_PASSWORD={{ .Data.data.NEO4J_PASSWORD }}\n{{- end -}}\n","vault.hashicorp.com/role":"zerotoship"},"labels":{"app":"zerotoship","component":"app"}},"spec":{"containers":[{"env":[{"name":"NEO4J_URI","valueFrom":{"configMapKeyRef":{"key":"NEO4J_URI","name":"zerotoship-config"}}},{"name":"NEO4J_USER","valueFrom":{"configMapKeyRef":{"key":"NEO4J_USER","name":"zerotoship-config"}}},{"name":"PROMETHEUS_PORT","valueFrom":{"configMapKeyRef":{"key":"PROMETHEUS_PORT","name":"zerotoship-config"}}},{"name":"MEMORY_FILE_PATH","valueFrom":{"configMapKeyRef":{"key":"MEMORY_FILE_PATH","name":"zerotoship-config"}}},{"name":"CREWAI_MEMORY_PATH","valueFrom":{"configMapKeyRef":{"key":"CREWAI_MEMORY_PATH","name":"zerotoship-config"}}},{"name":"HOME","valueFrom":{"configMapKeyRef":{"key":"HOME","name":"zerotoship-config"}}},{"name":"LOG_LEVEL","valueFrom":{"configMapKeyRef":{"key":"LOG_LEVEL","name":"zerotoship-config"}}},{"name":"CREWAI_LOG_LEVEL","valueFrom":{"configMapKeyRef":{"key":"CREWAI_LOG_LEVEL","name":"zerotoship-config"}}},{"name":"ENVIRONMENT","valueFrom":{"configMapKeyRef":{"key":"ENVIRONMENT","name":"zerotoship-config"}}},{"name":"PROJECT_NAME","valueFrom":{"configMapKeyRef":{"key":"PROJECT_NAME","name":"zerotoship-config"}}},{"name":"NEO4J_PASSWORD","valueFrom":{"secretKeyRef":{"key":"database.env","name":"vault-agent-injector"}}},{"name":"OPENAI_API_KEY","valueFrom":{"secretKeyRef":{"key":"apikeys.env","name":"vault-agent-injector"}}},{"name":"ANTHROPIC_API_KEY","valueFrom":{"secretKeyRef":{"key":"apikeys.env","name":"vault-agent-injector"}}},{"name":"IDEA","value":"Default Production Idea"},{"name":"WORKFLOW","value":"validation_and_launch"}],"image":"includebrake/zerotoship:latest","imagePullPolicy":"Always","livenessProbe":{"failureThreshold":3,"httpGet":{"path":"/metrics","port":8000},"initialDelaySeconds":60,"periodSeconds":30,"timeoutSeconds":10},"name":"zerotoship","ports":[{"containerPort":8000,"name":"metrics"}],"readinessProbe":{"failureThreshold":3,"httpGet":{"path":"/metrics","port":8000},"initialDelaySeconds":30,"periodSeconds":10,"timeoutSeconds":5},"resources":{"limits":{"cpu":"1000m","memory":"2Gi"},"requests":{"cpu":"250m","memory":"512Mi"}},"volumeMounts":[{"mountPath":"/app/output","name":"output-data"},{"mountPath":"/app/data","name":"app-data"}]}],"serviceAccountName":"zerotoship","volumes":[{"name":"output-data","persistentVolumeClaim":{"claimName":"zerotoship-output-pvc"}},{"name":"app-data","persistentVolumeClaim":{"claimName":"zerotoship-data-pvc"}}]}}}}
  creationTimestamp: "2025-08-10T09:15:12Z"
  generation: 4
  labels:
    app: zerotoship
    component: app
  name: zerotoship-app
  namespace: zerotoship
  resourceVersion: "384850"
  uid: 9b16d4a6-f929-4561-b458-8c2bcc0eb70a
spec:
  progressDeadlineSeconds: 600
  replicas: 3
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app: zerotoship
      component: app
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate
  template:
    metadata:
      annotations:
        vault.hashicorp.com/agent-inject: "true"
        vault.hashicorp.com/agent-inject-secret-apikeys.env: secret/data/zerotoship/dev/apikeys
        vault.hashicorp.com/agent-inject-secret-database.env: secret/data/zerotoship/dev/database
        vault.hashicorp.com/agent-inject-template-apikeys.env: |
          {{- with secret "secret/data/zerotoship/dev/apikeys" -}}
          OPENAI_API_KEY={{ .Data.data.OPENAI_API_KEY }}
          ANTHROPIC_API_KEY={{ .Data.data.ANTHROPIC_API_KEY }}
          {{- end -}}
        vault.hashicorp.com/agent-inject-template-database.env: |
          {{- with secret "secret/data/zerotoship/dev/database" -}}
          NEO4J_PASSWORD={{ .Data.data.NEO4J_PASSWORD }}
          {{- end -}}
        vault.hashicorp.com/role: zerotoship
      creationTimestamp: null
      labels:
        app: zerotoship
        component: app
    spec:
      containers:
      - env:
        - name: NEO4J_URI
          valueFrom:
            configMapKeyRef:
              key: NEO4J_URI
              name: zerotoship-config
        - name: NEO4J_USER
          valueFrom:
            configMapKeyRef:
              key: NEO4J_USER
              name: zerotoship-config
        - name: PROMETHEUS_PORT
          valueFrom:
            configMapKeyRef:
              key: PROMETHEUS_PORT
              name: zerotoship-config
        - name: MEMORY_FILE_PATH
          valueFrom:
            configMapKeyRef:
              key: MEMORY_FILE_PATH
              name: zerotoship-config
        - name: CREWAI_MEMORY_PATH
          valueFrom:
            configMapKeyRef:
              key: CREWAI_MEMORY_PATH
              name: zerotoship-config
        - name: HOME
          valueFrom:
            configMapKeyRef:
              key: HOME
              name: zerotoship-config
        - name: LOG_LEVEL
          valueFrom:
            configMapKeyRef:
              key: LOG_LEVEL
              name: zerotoship-config
        - name: CREWAI_LOG_LEVEL
          valueFrom:
            configMapKeyRef:
              key: CREWAI_LOG_LEVEL
              name: zerotoship-config
        - name: ENVIRONMENT
          valueFrom:
            configMapKeyRef:
              key: ENVIRONMENT
              name: zerotoship-config
        - name: PROJECT_NAME
          valueFrom:
            configMapKeyRef:
              key: PROJECT_NAME
              name: zerotoship-config
        - name: NEO4J_PASSWORD
          valueFrom:
            secretKeyRef:
              key: database.env
              name: vault-agent-injector
        - name: OPENAI_API_KEY
          valueFrom:
            secretKeyRef:
              key: apikeys.env
              name: vault-agent-injector
        - name: ANTHROPIC_API_KEY
          valueFrom:
            secretKeyRef:
              key: apikeys.env
              name: vault-agent-injector
        - name: IDEA
          value: Default Production Idea
        - name: WORKFLOW
          value: validation_and_launch
        image: includebrake/zerotoship:latest
        imagePullPolicy: Always
        livenessProbe:
          failureThreshold: 3
          httpGet:
            path: /metrics
            port: 8000
            scheme: HTTP
          initialDelaySeconds: 60
          periodSeconds: 30
          successThreshold: 1
          timeoutSeconds: 10
        name: zerotoship
        ports:
        - containerPort: 8000
          name: metrics
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /metrics
            port: 8000
            scheme: HTTP
          initialDelaySeconds: 30
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 5
        resources:
          limits:
            cpu: "1"
            memory: 2Gi
          requests:
            cpu: 250m
            memory: 512Mi
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
        volumeMounts:
        - mountPath: /app/output
          name: output-data
        - mountPath: /app/data
          name: app-data
      dnsPolicy: ClusterFirst
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: {}
      serviceAccount: zerotoship
      serviceAccountName: zerotoship
      terminationGracePeriodSeconds: 30
      volumes:
      - name: output-data
        persistentVolumeClaim:
          claimName: zerotoship-output-pvc
      - name: app-data
        persistentVolumeClaim:
          claimName: zerotoship-data-pvc
status:
  conditions:
  - lastTransitionTime: "2025-08-10T09:15:12Z"
    lastUpdateTime: "2025-08-10T09:15:12Z"
    message: Deployment does not have minimum availability.
    reason: MinimumReplicasUnavailable
    status: "False"
    type: Available
  - lastTransitionTime: "2025-08-10T11:21:50Z"
    lastUpdateTime: "2025-08-10T11:21:50Z"
    message: ReplicaSet "zerotoship-app-6586fc6657" has timed out progressing.
    reason: ProgressDeadlineExceeded
    status: "False"
    type: Progressing
  observedGeneration: 4
  replicas: 4
  unavailableReplicas: 4
  updatedReplicas: 2
