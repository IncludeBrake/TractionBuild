# ZeroToShip Helm Chart Values
# Production-ready configuration for enterprise deployment

# Global configuration
global:
  imageRegistry: ""
  imagePullSecrets: []
  storageClass: ""

# Application configuration
app:
  name: zerotoship
  version: "1.0.0"
  
# API Gateway configuration
api:
  enabled: true
  replicaCount: 3
  image:
    repository: zerotoship/api
    tag: "1.0.0"
    pullPolicy: IfNotPresent
  
  service:
    type: ClusterIP
    port: 8080
    targetPort: 8080
  
  ingress:
    enabled: true
    className: "nginx"
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      nginx.ingress.kubernetes.io/rate-limit: "100"
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
    hosts:
      - host: api.zerotoship.ai
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: zerotoship-api-tls
        hosts:
          - api.zerotoship.ai
  
  resources:
    limits:
      cpu: 2000m
      memory: 4Gi
    requests:
      cpu: 500m
      memory: 1Gi
  
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

# Celery Worker configuration
worker:
  enabled: true
  replicaCount: 5
  image:
    repository: zerotoship/worker
    tag: "1.0.0"
    pullPolicy: IfNotPresent
  
  resources:
    limits:
      cpu: 4000m
      memory: 8Gi
    requests:
      cpu: 1000m
      memory: 2Gi
  
  autoscaling:
    enabled: true
    minReplicas: 5
    maxReplicas: 20
    targetCPUUtilizationPercentage: 75
  
  # Celery configuration
  celery:
    concurrency: 4
    maxTasksPerChild: 100
    taskTimeLimit: 1800  # 30 minutes
    taskSoftTimeLimit: 1500  # 25 minutes

# Celery Beat Scheduler
scheduler:
  enabled: true
  replicaCount: 1
  image:
    repository: zerotoship/scheduler
    tag: "1.0.0"
    pullPolicy: IfNotPresent
  
  resources:
    limits:
      cpu: 500m
      memory: 1Gi
    requests:
      cpu: 100m
      memory: 256Mi

# Redis configuration
redis:
  enabled: true
  architecture: replication
  auth:
    enabled: true
    password: "zerotoship-redis-password"
  master:
    persistence:
      enabled: true
      size: 8Gi
  replica:
    replicaCount: 2
    persistence:
      enabled: true
      size: 8Gi

# PostgreSQL configuration (for project registry)
postgresql:
  enabled: true
  auth:
    postgresPassword: "zerotoship-postgres-password"
    database: "zerotoship"
  primary:
    persistence:
      enabled: true
      size: 20Gi
  metrics:
    enabled: true

# Neo4j configuration (for graph database)
neo4j:
  enabled: true
  image:
    repository: neo4j
    tag: "5.15.0"
  auth:
    password: "zerotoship-neo4j-password"
  persistence:
    enabled: true
    size: 50Gi
  resources:
    limits:
      cpu: 2000m
      memory: 4Gi
    requests:
      cpu: 500m
      memory: 2Gi

# SPIFFE/SPIRE configuration for zero-trust security
spiffe:
  enabled: true
  
  # SPIRE Server
  server:
    enabled: true
    replicaCount: 3
    image:
      repository: ghcr.io/spiffe/spire-server
      tag: "1.8.7"
    
    resources:
      limits:
        cpu: 1000m
        memory: 2Gi
      requests:
        cpu: 200m
        memory: 512Mi
    
    persistence:
      enabled: true
      size: 10Gi
    
    config:
      trustDomain: "zerotoship.ai"
      
  # SPIRE Agent
  agent:
    enabled: true
    image:
      repository: ghcr.io/spiffe/spire-agent
      tag: "1.8.7"
    
    resources:
      limits:
        cpu: 500m
        memory: 1Gi
      requests:
        cpu: 100m
        memory: 256Mi

# Monitoring configuration
monitoring:
  enabled: true
  
  # Prometheus
  prometheus:
    enabled: true
    server:
      retention: "30d"
      persistentVolume:
        enabled: true
        size: 100Gi
    
    # Custom scrape configs for ZeroToShip metrics
    extraScrapeConfigs: |
      - job_name: 'zerotoship-api'
        static_configs:
          - targets: ['zerotoship-api:8080']
        metrics_path: '/metrics'
        scrape_interval: 30s
      
      - job_name: 'zerotoship-workers'
        kubernetes_sd_configs:
          - role: pod
        relabel_configs:
          - source_labels: [__meta_kubernetes_pod_label_app]
            action: keep
            regex: zerotoship-worker
          - source_labels: [__meta_kubernetes_pod_ip]
            target_label: __address__
            replacement: '${1}:8000'
  
  # Grafana
  grafana:
    enabled: true
    adminPassword: "zerotoship-grafana-admin"
    
    persistence:
      enabled: true
      size: 10Gi
    
    # Pre-configured dashboards
    dashboardProviders:
      dashboardproviders.yaml:
        apiVersion: 1
        providers:
        - name: 'zerotoship'
          orgId: 1
          folder: 'ZeroToShip'
          type: file
          disableDeletion: false
          editable: true
          options:
            path: /var/lib/grafana/dashboards/zerotoship
    
    dashboards:
      zerotoship:
        workflow-performance:
          url: https://raw.githubusercontent.com/zerotoship/monitoring/main/grafana/workflow-performance.json
        system-health:
          url: https://raw.githubusercontent.com/zerotoship/monitoring/main/grafana/system-health.json
        sustainability:
          url: https://raw.githubusercontent.com/zerotoship/monitoring/main/grafana/sustainability.json
  
  # AI Anomaly Detection Service
  anomalyDetector:
    enabled: true
    replicaCount: 1
    image:
      repository: zerotoship/anomaly-detector
      tag: "1.0.0"
    
    resources:
      limits:
        cpu: 2000m
        memory: 4Gi
        nvidia.com/gpu: 1  # Optional GPU for ML inference
      requests:
        cpu: 500m
        memory: 2Gi
    
    config:
      modelPath: "/models/anomaly_detection_model.h5"
      trainingInterval: "6h"
      anomalyThreshold: 0.7

# Security configuration
security:
  # Pod Security Standards
  podSecurityStandards:
    enabled: true
    enforce: "restricted"
  
  # Network Policies
  networkPolicies:
    enabled: true
    
  # Service Mesh (Istio)
  serviceMesh:
    enabled: false  # Optional Istio integration
    
  # Secrets management
  vault:
    enabled: true
    address: "https://vault.zerotoship.ai"
    authPath: "auth/kubernetes"
    role: "zerotoship"

# Sustainability and compliance
sustainability:
  # CodeCarbon integration
  carbonTracking:
    enabled: true
    projectName: "zerotoship-production"
    
  # Resource optimization
  resourceOptimization:
    enabled: true
    
# Storage configuration
storage:
  # Persistent volumes for stateful components
  persistence:
    enabled: true
    storageClass: "fast-ssd"
    
  # Backup configuration
  backup:
    enabled: true
    schedule: "0 2 * * *"  # Daily at 2 AM
    retention: "30d"

# Networking
networking:
  # Service mesh configuration
  serviceMesh:
    enabled: false
    
  # Load balancer
  loadBalancer:
    enabled: true
    type: "nginx"

# Development and testing
development:
  enabled: false
  
  # Debug mode
  debug:
    enabled: false
    
  # Test data
  seedData:
    enabled: false

# Node affinity and tolerations
nodeSelector: {}

tolerations: []

affinity:
  # Prefer spreading pods across nodes
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
    - weight: 100
      podAffinityTerm:
        labelSelector:
          matchExpressions:
          - key: app.kubernetes.io/name
            operator: In
            values:
            - zerotoship
        topologyKey: kubernetes.io/hostname